<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>stripe-payment | ä¸€äº›ç¢ç¢å¿µ</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="/css/prism.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">stripe-payment</h1><a id="logo" href="/.">ä¸€äº›ç¢ç¢å¿µ</a><p class="description">è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œè¾¹èµ°è¾¹çœ‹å§</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">stripe-payment</h1><div class="post-meta">2023-10-09</div><a class="disqus-comment-count" href="/2023/10/09/stripe-payment/#vcomment"><span class="valine-comment-count" data-xid="/2023/10/09/stripe-payment/"></span><span> æ¡è¯„è®º</span></a><div class="post-content"><p>æœ€è¿‘æ¥æ”¶é¡¹ç›®é‡åˆ°ä¸€ä¸ªbug, ä½¿ç”¨stripeçš„paymentç›¸å…³æ”¯ä»˜çš„æ—¶å€™é¡µé¢å±•ç¤ºçš„å…ƒç´ é‡å¤ï¼Œè§ä¸‹å›¾</p>
<p><img src="/images/stripe.jpg"></p>
<p>ç›¸å…³ä»£ç å¦‚ä¸‹</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">  <span class="token keyword">const</span> <span class="token literal-property property">paymentElementOptions</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">layout</span><span class="token operator">:</span> <span class="token string">'tabs'</span>
  <span class="token punctuation">&#125;</span>

<span class="token operator">&lt;</span>form id<span class="token operator">=</span><span class="token string">"payment-form"</span> onSubmit<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleSubmit<span class="token punctuation">&#125;</span> className<span class="token operator">=</span><span class="token string">"text-cap"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>LinkAuthenticationElement id<span class="token operator">=</span><span class="token string">"link-authentication-element"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>AddressElement options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'billing'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>PaymentElement id<span class="token operator">=</span><span class="token string">"payment-element"</span> options<span class="token operator">=</span><span class="token punctuation">&#123;</span>paymentElementOptions<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Center<span class="token operator">></span>
        <span class="token operator">&lt;</span>Button my<span class="token operator">=</span><span class="token string">"4"</span> colorScheme<span class="token operator">=</span><span class="token string">"green"</span> type<span class="token operator">=</span><span class="token string">"submit"</span> disabled<span class="token operator">=</span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">||</span> <span class="token operator">!</span>stripe <span class="token operator">||</span> <span class="token operator">!</span>elements<span class="token punctuation">&#125;</span> id<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"button-text"</span><span class="token operator">></span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">?</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"spinner"</span> id<span class="token operator">=</span><span class="token string">"spinner"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span> <span class="token operator">:</span> <span class="token string">'Pay Now'</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Center<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* Show any error or success messages */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Center<span class="token operator">></span><span class="token punctuation">&#123;</span>message <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"payment-message"</span><span class="token operator">></span><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Center<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>äº§å“çš„è¯‰æ±‚æ˜¯éœ€è¦ç”¨æˆ·å¡«å†™ç›¸å…³addressçš„ä¿¡æ¯<br>çœ‹ä»£ç  çŒœæµ‹åº”è¯¥æ˜¯ç›¸å…³é…ç½®ç¼ºå¤±å¯¼è‡´çš„ï¼Œ<br>ç¬¬ä¸€æ¬¡æ¥è§¦stripeè¿™ä¸ªæ”¯ä»˜çš„SDKï¼Œç¿»çœ‹äº†ä¸€ä¸‹ç›¸å…³æ–‡æ¡£ï¼Œ<a target="_blank" rel="noopener" href="https://stripe.com/docs/stripe-js/react">https://stripe.com/docs/stripe-js/react</a><br>å’‹ä¸€çœ‹æ²¡å‘ç°æœ‰ä»€ä¹ˆä¸å¯¹ï¼Œä¹Ÿæ²¡æ‰¾åˆ°ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œè€ç€æ€§å­ä¸€ä¸ªä¸€ä¸ªç¿»ï¼Œ</p>
<p>ç»ˆäºåœ¨<a target="_blank" rel="noopener" href="https://stripe.com/docs/js/elements_object/create_payment_element#payment_element_create-customized_fieldss">payment_element_create-customized_fieldss</a>çš„æ–‡æ¡£ä¸­æ‰¾åˆ°äº†ä¸€äº›é…ç½®ä¿¡æ¯</p>
<h3 id="paymane-element"><a href="#paymane-element" class="headerlink" title="paymane_element"></a>paymane_element</h3> <font color="green">
  billingDetails: 'never' | 'auto' | object
  Specify never to avoid collecting all billing details in the Payment Element. 
 If you would like to disable only certain billing details, 
  pass an object specifying which fields you would like to disable collection for.
  The default setting for each field or object is auto.
 
 </font>

<p>å¤§æ„å°±æ˜¯å¯ä»¥é…ç½®ç›¸å…³æ”¯ä»˜é€‰é¡¹çš„é…ç½®ä¿¡æ¯,æœ‰è¿™äº›é…ç½® é»˜è®¤æ˜¯auto</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">
<span class="token literal-property property">name</span><span class="token operator">:</span>
<span class="token string">'never'</span> <span class="token operator">|</span> <span class="token string">'auto'</span>
<span class="token literal-property property">email</span><span class="token operator">:</span>
<span class="token string">'never'</span> <span class="token operator">|</span> <span class="token string">'auto'</span>
<span class="token literal-property property">phone</span><span class="token operator">:</span>
<span class="token string">'never'</span> <span class="token operator">|</span> <span class="token string">'auto'</span>
<span class="token literal-property property">address</span><span class="token operator">:</span>
<span class="token string">'never'</span> <span class="token operator">|</span> <span class="token string">'auto'</span> <span class="token operator">|</span> object
<span class="token comment">// ä½¿ç”¨æ–¹æ³•</span>
<span class="token keyword">var</span> paymentElement <span class="token operator">=</span> elements<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'payment'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">billingDetails</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'never'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'never'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="æœ‰ä¸€æ®µæ³¨æ„äº‹é¡¹ï¼š"><a href="#æœ‰ä¸€æ®µæ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="æœ‰ä¸€æ®µæ³¨æ„äº‹é¡¹ï¼š"></a>æœ‰ä¸€æ®µæ³¨æ„äº‹é¡¹ï¼š</h5><ul>
<li><a target="_blank" rel="noopener" href="https://stripe.com/docs/js/elements_object/create_payment_element#payment_element_create-options-fields">https://stripe.com/docs/js/elements_object&#x2F;create_payment_element#payment_element_create-options-fields</a></li>
</ul>
<p>By default, the Payment Element will collect all necessary details to complete a payment.</p>
<p>For some payment methods, this means that the Payment Element will collect details like name or email that you may have already collected from the user. If this is the case, you can prevent the Payment Element from collecting these data by using the fields option.</p>
<p><font color='red'>If you disable the collection of a certain field with the fields option, you must pass that same data to stripe.confirmPayment or the payment will be rejected.</p>
<p>See below for details.</font></p>
<p>å¤§æ„å°±è¯´ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œä»˜æ¬¾å…ƒç´ å°†æ”¶é›†å®Œæˆä»˜æ¬¾æ‰€éœ€çš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>å¯¹äºæŸäº›ä»˜æ¬¾æ–¹å¼ï¼Œè¿™æ„å‘³ç€ä»˜æ¬¾å…ƒç´ å°†æ”¶é›†æ‚¨å¯èƒ½å·²ä»ç”¨æˆ·é‚£é‡Œæ”¶é›†çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚å§“åæˆ–ç”µå­é‚®ä»¶ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥é€‰é¡¹é˜»æ­¢ä»˜æ¬¾å…ƒç´ æ”¶é›†è¿™äº›æ•°æ®fieldsã€‚</p>
<p><font color='red'>å¦‚æœæ‚¨ä½¿ç”¨è¯¥é€‰é¡¹ç¦ç”¨æŸä¸ªå­—æ®µçš„æ”¶é›†fieldsï¼Œåˆ™å¿…é¡»å°†ç›¸åŒçš„æ•°æ®ä¼ é€’ç»™stripe.confirmPayment ï¼Œå¦åˆ™ä»˜æ¬¾å°†è¢«æ‹’ç»</font></p>
<p> ä¸‹é¢æ‰¾åˆ° address_element å°±å¥½äº† </p>
<h3 id="address-element"><a href="#address-element" class="headerlink" title="address_element"></a>address_element</h3><ul>
<li><a target="_blank" rel="noopener" href="https://stripe.com/docs/js/element/address_element">https://stripe.com/docs/js/element/address_element</a></li>
</ul>
<h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><p>  <font color="red">ä½¿ç”¨è¿™ç§æ–¹å¼ç›‘å¬åœ°å€å˜åŒ–æ˜¯æœ‰bugçš„<br>  å½“ä½ ä½¿ç”¨chromeçš„è‡ªåŠ¨å¡«å……åœ°å€ä¿¡æ¯çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°å¹¶æ²¡æœ‰è§¦å‘è¿™ä¸ªonChangeçš„äº‹ä»¶<br>  </font></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">
  <span class="token keyword">const</span> <span class="token function-variable function">handleAddressChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>complete<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// Extract potentially complete address</span>
      <span class="token keyword">const</span> address <span class="token operator">=</span> event<span class="token punctuation">.</span>value<span class="token punctuation">.</span>address
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
      <span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span>AddressElement options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'billing'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleAddressChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¸è¿‡å®ƒæä¾›äº†å¦å¤–ä¸€ç§æ–¹å¼</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> PaymentElement<span class="token punctuation">,</span> LinkAuthenticationElement<span class="token punctuation">,</span> useStripe<span class="token punctuation">,</span> AddressElement<span class="token punctuation">,</span> useElements <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@stripe/react-stripe-js'</span>


 <span class="token keyword">const</span> elements <span class="token operator">=</span> <span class="token function">useElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">getAddressValue</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> addressElement <span class="token operator">=</span> elements<span class="token punctuation">.</span><span class="token function">getElement</span><span class="token punctuation">(</span><span class="token string">'address'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>addressElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> complete<span class="token punctuation">,</span> value <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> addressElement<span class="token operator">?.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>complete<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token comment">// Allow user to proceed to the next step</span>
          <span class="token comment">// Optionally, use value to store the address details</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token keyword">return</span> value
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å¦å¤–éœ€è¦æ³¨æ„addressçš„valueçš„è¿”å›å€¼ä¸ä»…ä»…æ˜¯åœ°å€ï¼Œè¿˜æœ‰nameç­‰å­—æ®µ</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
    name<span class="token punctuation">,</span>
    email<span class="token punctuation">,</span>
    phone<span class="token punctuation">,</span>
    <span class="token literal-property property">address</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
        line1<span class="token punctuation">,</span>
        line2<span class="token punctuation">,</span>
        city<span class="token punctuation">,</span>
        state<span class="token punctuation">,</span>
        country<span class="token punctuation">,</span>
        postalCode<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ‰ç‚¹çŸ›ç›¾çš„åœ°æ–¹<br><a target="_blank" rel="noopener" href="https://stripe.com/docs/js/elements_object/create_address_element#address_element_create-options-mode">https://stripe.com/docs/js/elements_object&#x2F;create_address_element#address_element_create-options-mode</a></p>
<hr>
<p>Specify which mode you would like to use Address Element for.</p>
<p> When shipping mode is used with the Payment Element and Link Authentication Element, it will automatically pass shipping information when confirming Payment Intent or Setup Intent.</p>
<p>When billing mode is used with the Payment Element, it will automatically pass the billing information when confirming Payment Intent or Setup Intent.</p>
<h2 id="å¤§æ„æ˜¯è¯´å½“-Address-Element-ä¸Payment-Elementè”åˆä½¿ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨æŠŠç›¸å…³ä¿¡æ¯å¸¦å…¥åˆ°æ”¯ä»˜ä¿¡æ¯é‡Œï¼Œå®æµ‹ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ä¿é™©èµ·è§ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨ä¼ å…¥"><a href="#å¤§æ„æ˜¯è¯´å½“-Address-Element-ä¸Payment-Elementè”åˆä½¿ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨æŠŠç›¸å…³ä¿¡æ¯å¸¦å…¥åˆ°æ”¯ä»˜ä¿¡æ¯é‡Œï¼Œå®æµ‹ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ä¿é™©èµ·è§ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨ä¼ å…¥" class="headerlink" title="å¤§æ„æ˜¯è¯´å½“  Address Element ä¸Payment Elementè”åˆä½¿ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨æŠŠç›¸å…³ä¿¡æ¯å¸¦å…¥åˆ°æ”¯ä»˜ä¿¡æ¯é‡Œï¼Œå®æµ‹ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ä¿é™©èµ·è§ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨ä¼ å…¥"></a>å¤§æ„æ˜¯è¯´å½“  Address Element ä¸Payment Elementè”åˆä½¿ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨æŠŠç›¸å…³ä¿¡æ¯å¸¦å…¥åˆ°æ”¯ä»˜ä¿¡æ¯é‡Œï¼Œå®æµ‹ä¹Ÿç¡®å®å¦‚æ­¤ï¼Œä¸è¿‡ä¿é™©èµ·è§ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨ä¼ å…¥</h2><h3 id="æœ€ç»ˆçš„è§£å†³"><a href="#æœ€ç»ˆçš„è§£å†³" class="headerlink" title="æœ€ç»ˆçš„è§£å†³"></a>æœ€ç»ˆçš„è§£å†³</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useImperativeHandle<span class="token punctuation">,</span> forwardRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> PaymentElement<span class="token punctuation">,</span> LinkAuthenticationElement<span class="token punctuation">,</span> useStripe<span class="token punctuation">,</span> AddressElement<span class="token punctuation">,</span> useElements <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@stripe/react-stripe-js'</span>
 
 
<span class="token keyword">export</span> <span class="token keyword">const</span> CheckoutForm <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">MyInput</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> stripe <span class="token operator">=</span> <span class="token function">useStripe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> elements <span class="token operator">=</span> <span class="token function">useElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 
  <span class="token keyword">const</span> <span class="token punctuation">[</span>email<span class="token punctuation">,</span> setEmail<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
 
  <span class="token keyword">const</span> <span class="token literal-property property">paymentElementOptions</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">layout</span><span class="token operator">:</span> <span class="token string">'tabs'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">billingDetails</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'never'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">'never'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">'never'</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getAddressValue</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> addressElement <span class="token operator">=</span> elements<span class="token punctuation">.</span><span class="token function">getElement</span><span class="token punctuation">(</span><span class="token string">'address'</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>addressElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> complete<span class="token punctuation">,</span> value <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">await</span> addressElement<span class="token operator">?.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>complete<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token comment">// Allow user to proceed to the next step</span>
          <span class="token comment">// Optionally, use value to store the address details</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token keyword">return</span> value
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">e</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stripe <span class="token operator">||</span> <span class="token operator">!</span>elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> addressValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">getAddressValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> any
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'===addressValue=='</span><span class="token punctuation">,</span> addressValue<span class="token punctuation">)</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> error <span class="token punctuation">&#125;</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token keyword">await</span> stripe<span class="token punctuation">.</span><span class="token function">confirmPayment</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        elements<span class="token punctuation">,</span>
        <span class="token literal-property property">confirmParams</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">return_url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/payment/completion</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">payment_method_data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">billing_details</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">email</span><span class="token operator">:</span> email<span class="token punctuation">,</span>
              <span class="token operator">...</span>addressValue<span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'card_error'</span> <span class="token operator">||</span> error<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'validation_error'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">setMessage</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token string">'An unexpected error occurred.'</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  
  <span class="token punctuation">&#125;</span>

 
 
  <span class="token keyword">const</span> <span class="token function-variable function">handleLinkChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> email <span class="token operator">=</span> event<span class="token punctuation">.</span>value<span class="token punctuation">.</span>email
    <span class="token function">setEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>form id<span class="token operator">=</span><span class="token string">"payment-form"</span> onSubmit<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleSubmit<span class="token punctuation">&#125;</span> className<span class="token operator">=</span><span class="token string">"text-cap"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>LinkAuthenticationElement id<span class="token operator">=</span><span class="token string">"link-authentication-element"</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleLinkChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>AddressElement options<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'billing'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>   <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>PaymentElement id<span class="token operator">=</span><span class="token string">"payment-element"</span> options<span class="token operator">=</span><span class="token punctuation">&#123;</span>paymentElementOptions<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>Center<span class="token operator">></span>
        <span class="token operator">&lt;</span>Button my<span class="token operator">=</span><span class="token string">"4"</span> colorScheme<span class="token operator">=</span><span class="token string">"green"</span> type<span class="token operator">=</span><span class="token string">"submit"</span> disabled<span class="token operator">=</span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">||</span> <span class="token operator">!</span>stripe <span class="token operator">||</span> <span class="token operator">!</span>elements<span class="token punctuation">&#125;</span> id<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">"button-text"</span><span class="token operator">></span><span class="token punctuation">&#123;</span>isLoading <span class="token operator">?</span> <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"spinner"</span> id<span class="token operator">=</span><span class="token string">"spinner"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span> <span class="token operator">:</span> <span class="token string">'Pay Now'</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Center<span class="token operator">></span>
      <span class="token punctuation">&#123;</span><span class="token comment">/* Show any error or success messages */</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span>Center<span class="token operator">></span><span class="token punctuation">&#123;</span>message <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"payment-message"</span><span class="token operator">></span><span class="token punctuation">&#123;</span>message<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Center<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ¬æ–‡ä½œè€…ï¼šç•ªèŒ„ç‚’è›‹<br />æœ¬æ–‡åœ°å€ï¼š <a href="https://www.noway.pub/2023/10/09/stripe-payment/">https://www.noway.pub/2023/10/09/stripe-payment/</a> <br />ç‰ˆæƒå£°æ˜ï¼šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul></div><div class="post-nav"><a class="pre" href="/2023/10/12/pdf_error-FormatError_Bad_FCHECK/">pdf-FormatError  Bad FCHECK in flate stream</a><a class="next" href="/2023/09/18/USD-option/">USD_option_SPY</a></div><div class="nofancybox" id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'false' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'qRUb5ezrBE5yTKOj5mHqbUEK-gzGzoHsz',
  appKey:'sNTjZX5EQcMV03lzSQvr7Rch',
  serverURLs:'https://qrub5ezr.lc-cn-n1-shared.com',
  placeholder:'Just so so',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://www.noway.pub"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/images/avatar.jpeg"/></a><p>äººç”Ÿä¹‹è·¯å¦‚ä¿®è¡Œ</p><a class="info-icon" href="https://github.com/wych1987" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/typescript/" style="font-size: 15px;">typescript</a> <a href="/tags/%E7%90%86%E8%B4%A2/" style="font-size: 15px;">ç†è´¢</a> <a href="/tags/%E5%8F%A8%E5%8F%A8/" style="font-size: 15px;">å¨å¨</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/10/12/pdf_error-FormatError_Bad_FCHECK/">pdf-FormatError  Bad FCHECK in flate stream</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/10/09/stripe-payment/">stripe-payment</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/18/USD-option/">USD_option_SPY</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/16/Nullish-coalescing/">ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦ï¼ˆ??ï¼‰</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/12/sep-something/">ä¹æœˆçš„ä¸€äº›å›æƒ³</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/10/first-screen-speed/">é¡µé¢é¦–å±æ¸²æŸ“ä¼˜åŒ–</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/10/ke_zhuan_zhai/">å¯è½¬å€ºåŸºç¡€çŸ¥è¯†</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/08/NPM_interface/">typescriptä¿®æ”¹npmåŒ…çš„ç±»å‹å®šä¹‰</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/09/07/react_setState/">react setStateåŒæ­¥æ›´æ–°ä¸å¼‚æ­¥æ›´æ–°</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2023 <a href="/." rel="nofollow">ä¸€äº›ç¢ç¢å¿µ.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>